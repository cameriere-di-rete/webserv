<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redirects - webserv</title>
  <link rel="stylesheet" href="/css/style.css" />
  <style>
    html,
    body {
      overflow: auto !important;
      height: auto !important;
      min-height: 100vh;
    }
  </style>
</head>

<body class="test-page">
  <div class="container">
    <a href="/tests/" class="back-link">‚Üê Back to Test Suite</a>
    <h1>üîÄ Redirects</h1>
    <p class="subtitle">Test HTTP redirect responses</p>

    <h2>Configured Redirects</h2>
    <div class="test-grid">
      <a href="/42" class="test-card">
        <h3><span class="method get">GET</span> /42</h3>
        <p>302 redirect to https://42.fr</p>
      </a>
    </div>

    <h2>Test Redirect (without following)</h2>
    <div class="interactive">
      <p style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 1rem">
        This test fetches the redirect without following it, so you can see the redirect response.
      </p>
      <label for="redirect-path">Redirect Path:</label>
      <input type="text" id="redirect-path" value="/42" />

      <button onclick="testRedirect()">Test Redirect</button>
      <div id="redirect-response" class="response-box"></div>
    </div>

    <h2>Redirect Status Codes</h2>
    <div class="interactive">
      <p style="color: #94a3b8; font-size: 0.875rem">
        Common HTTP redirect status codes:
      </p>
      <ul>
        <li><strong>301</strong> - Moved Permanently</li>
        <li><strong>302</strong> - Found (Temporary Redirect)</li>
        <li><strong>303</strong> - See Other</li>
        <li><strong>307</strong> - Temporary Redirect</li>
        <li><strong>308</strong> - Permanent Redirect</li>
      </ul>
    </div>
  </div>

  <footer class="footer">webserv by fmartusc, edforte, lrocca</footer>
  <script type="module">
    import { renderStatus, renderPre, renderError } from '/tests/common.js';

    async function testRedirect() {
      const path = document.getElementById("redirect-path").value;
      const responseDiv = document.getElementById("redirect-response");
      responseDiv.innerHTML = "";
      try {
        const response = await fetch(path, { redirect: "manual" });
        const statusClass = response.status >= 300 && response.status < 400 ? "status-ok" : "status-error";
        renderStatus(responseDiv, response.status, response.statusText, statusClass);

        // Location
        responseDiv.appendChild(document.createElement("br"));
        const locationDiv = document.createElement("div");
        locationDiv.style.marginTop = "1em";
        const locationLabel = document.createElement("strong");
        locationLabel.textContent = "Location: ";
        locationDiv.appendChild(locationLabel);
        const locationValue = document.createElement("span");
        locationValue.textContent = response.headers.get("Location") || "(none)";
        locationDiv.appendChild(locationValue);
        responseDiv.appendChild(locationDiv);

        // Headers
        renderPre(responseDiv, "Headers:", Array.from(response.headers.entries()).map(([k, v]) => `  ${k}: ${v}`).join("\n"));
        responseDiv.classList.add("show");
      } catch (e) {
        renderError(responseDiv, e.message);
      }
    }

    // Make function available globally for onclick
    window.testRedirect = testRedirect;
  </script>
</body>

</html>
