# =============================================================================
# COMPLETE WEBSERV CONFIGURATION
# Combines all features from: cgi.conf, default.conf, test-features.conf,
# test.conf, and updated.conf
# =============================================================================

# Global Settings

# Error pages
error_page 400 /400.html;
error_page 401 /401.html;
error_page 402 /402.html;
error_page 403 /403.html;
error_page 404 /404.html;
error_page 405 /405.html;
error_page 406 /406.html;
error_page 408 /408.html;
error_page 409 /409.html;
error_page 410 /410.html;
error_page 413 /413.html;
error_page 414 /414.html;
error_page 415 /415.html;
error_page 416 /416.html;
error_page 417 /417.html;
error_page 418 /418.html;
error_page 426 /426.html;
error_page 428 /428.html;
error_page 429 /429.html;
error_page 431 /431.html;
error_page 451 /451.html;
error_page 500 /500.html;
error_page 501 /501.html;
error_page 502 /502.html;
error_page 503 /503.html;
error_page 504 /504.html;
error_page 505 /505.html;
error_page 507 /507.html;
error_page 509 /509.html;
error_page 510 /510.html;
error_page 511 /511.html;

# =============================================================================
# MAIN SERVER - Port 8080
# =============================================================================
server {
  listen 0.0.0.0:8080;
  root ./www;
  autoindex on;
  index index.html;

  # ---------------------------------------------------------------------------
  # STATIC FILES - Main website
  # ---------------------------------------------------------------------------
  location / {
    root ./www;
    allow_methods GET;
    autoindex off;
    index index.html;
  }

  # ---------------------------------------------------------------------------
  # CGI SCRIPTS - Execute scripts
  # ---------------------------------------------------------------------------
  location /cgi-bin/ {
    cgi_root ./www/cgi-bin;
    cgi_extensions .pl .py .cgi .sh .php;
    allow_methods GET POST;
  }

  # ---------------------------------------------------------------------------
  # UPLOADS - File upload/download/delete
  # ---------------------------------------------------------------------------
  location /uploads/ {
    root ./www/uploads;
    allow_methods GET POST PUT DELETE;
    autoindex on;
    max_request_body 104857600; # 100 MB
  }

  # Redirects removed per user request
}

# =============================================================================
# SECONDARY SERVER - Port 8081
# =============================================================================
server {
  listen 127.0.0.1:8081;
  root ./www;
  autoindex on;
  index index.html;

  location /new {
    root ./www;
    allow_methods GET;
    autoindex on;
    index index.html;
  }

  # Images with directory listing
  location /images/ {
    root ./www/image;
    allow_methods GET;
    autoindex on;
  }

  # CGI support on secondary server
  location /cgi-bin/ {
    cgi_root ./www/cgi-bin;
    cgi_extensions .pl .py .cgi .sh;
    allow_methods GET POST;
  }
}
